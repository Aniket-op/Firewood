<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join Cabin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="../css/style.css" rel="stylesheet">
</head>

<body>
    <div class="container d-flex flex-column justify-content-center align-items-center min-vh-100">
        <form id="guestForm" class="row g-3 item">
            <input type="text" class="form-control" autocomplete="off" id='guestName' placeholder="Your Name" required
                maxlength="30">
            <input type="text" class="form-control" autocomplete="off" id="cabinCode" placeholder="Cabin Code" required>
            <input class="btn btn-light glow invert" type="submit" id="submit" value="Join Cabin">
        </form>
        <hr>
        <button onclick="window.location.replace('/login')" class="btn btn-primary item">Have an account? Login</button>
    </div>

    <script>
        // Pre-fill cabin code if it's in the URL
        const urlParams = new URLSearchParams(window.location.search);
        const cabinParam = urlParams.get('cabin');
        if (cabinParam) {
            document.getElementById('cabinCode').value = cabinParam;
        }

        const form = document.getElementById('guestForm');
        form.addEventListener('submit', joinAsGuest);

        async function joinAsGuest(e) {
            e.preventDefault();

            const guestName = document.getElementById('guestName').value;
            const cabinCode = document.getElementById('cabinCode').value;

            const result = await fetch('/api/join-guest', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    guestName,
                    cabinCode
                })
            }).then(res => res.json());

            if (result.status === 'ok') {
                window.location.replace(`/cabin/${result.cabinCode}`);
            }
            else {
                alert(result.error);
                window.location.replace('/join');
            }
        }
    </script>
</body>

</html>